/*!
 * This file is part of MeCms.
 * @author		Mirko Pagliai <mirko.pagliai@gmail.com>
 * @copyright	Copyright (c) 2015, Mirko Pagliai for Nova Atlantis Ltd
 * @license		http://www.gnu.org/licenses/agpl.txt AGPL License
 * @see			http://www.script-tutorials.com/html5-drag-and-drop-multiple-file-uploader
 */
$(function(){var a=$("#uploader .upload-area");var r=$("#uploader .upload-icon");var o=$("#uploader .upload-info");var e=$("#uploader .progress");var n=$("#uploader .upload-error");var t=$("#uploader .upload-result");var s=2097152;var i=[];var l=0;var p=0;function u(a){var a=Math.floor(a*100);$(".progress-bar",e).width(a+"%").attr("aria-valuenow",a);$(".progress-bar span",e).html(a+"%")}function f(a){a.stopPropagation();a.preventDefault()}function d(a){a.stopPropagation();a.preventDefault();$(".fa",r).attr("class","fa fa-spin fa-spinner");if(n.is(":visible"))n.hide();$(".progress-bar",e).width("0").attr("aria-valuenow","0");$(".progress-bar span",e).html("");e.show();if(o.is(":hidden"))o.show();v(a.originalEvent.dataTransfer.files)}function v(a){if(!a||!a.length||i.length)return;l=0;p=0;t.empty();for(var r=0;r<a.length;r++){i.push(a[r]);l+=a[r].size}w()}function h(a){p+=a;u(p/l);w()}function c(a){var r=p+a.loaded;u(r/l)}function g(a,r){var o=new XMLHttpRequest;o.open("POST",window.location.href);o.onload=function(){t.append(this.responseText);h(a.size)};o.onerror=function(){t.html(this.responseText);h(a.size)};o.upload.onprogress=function(a){c(a)};o.upload.onloadstart=function(a){};var e=new FormData;e.append("file",a);o.send(e)}function w(){if(i.length){var a=i.shift();if(a.size>=s){$("strong",n).html(a.name);n.show();h(a.size)}else g(a,status)}else{$(".fa",r).attr("class","fa fa-cloud-upload");e.hide()}}a.on({drop:d,dragover:f})});