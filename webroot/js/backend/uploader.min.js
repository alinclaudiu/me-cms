/*!
 * This file is part of MeCms.
 * @author		Mirko Pagliai <mirko.pagliai@gmail.com>
 * @copyright	Copyright (c) 2015, Mirko Pagliai for Nova Atlantis Ltd
 * @license		http://www.gnu.org/licenses/agpl.txt AGPL License
 * @see			http://www.script-tutorials.com/html5-drag-and-drop-multiple-file-uploader
 */
$(function(){var a=$("#uploader .upload-area");var o=$("#uploader .upload-icon");var r=$("#uploader .upload-info");var e=$("#uploader .progress");var n=$("#uploader .upload-error");var t=$("#uploader .upload-result");var i=2097152;var s=[];var l=0;var p=0;function u(a){var a=Math.floor(a*100);$(".progress-bar",e).width(a+"%").attr("aria-valuenow",a)}function f(a){a.stopPropagation();a.preventDefault()}function d(a){a.stopPropagation();a.preventDefault();$(".fa",o).attr("class","fa fa-spin fa-spinner");if(n.is(":visible"))n.hide();$(".progress-bar",e).width("0").attr("aria-valuenow","0");e.show();if(r.is(":hidden"))r.show();v(a.originalEvent.dataTransfer.files)}function v(a){if(!a||!a.length||s.length)return;l=0;p=0;t.empty();for(var o=0;o<a.length;o++){s.push(a[o]);l+=a[o].size}w()}function h(a){p+=a;u(p/l);w()}function c(a){var o=p+a.loaded;u(o/l)}function g(a,o){var r=new XMLHttpRequest;r.open("POST",window.location.href);r.onload=function(){t.append(this.responseText);h(a.size)};r.onerror=function(){t.html(this.responseText);h(a.size)};r.upload.onprogress=function(a){c(a)};r.upload.onloadstart=function(a){};var e=new FormData;e.append("file",a);r.send(e)}function w(){if(s.length){var a=s.shift();if(a.size>=i){$("strong",n).html(a.name);n.show();h(a.size)}else g(a,status)}else{$(".fa",o).attr("class","fa fa-cloud-upload");e.hide()}}a.on({drop:d,dragover:f})});