/*!
 * This file is part of MeCms.
 * @author		Mirko Pagliai <mirko.pagliai@gmail.com>
 * @copyright	Copyright (c) 2015, Mirko Pagliai for Nova Atlantis Ltd
 * @license		http://www.gnu.org/licenses/agpl.txt AGPL License
 * @see			http://www.script-tutorials.com/html5-drag-and-drop-multiple-file-uploader
 */
$(function(){function a(a){var a=Math.floor(100*a);$(".progress-bar",d).width(a+"%").attr("aria-valuenow",a),$(".progress-bar span",d).html(a+"%")}function o(a){a.stopPropagation(),a.preventDefault()}function n(a){a.stopPropagation(),a.preventDefault(),$(".fa",l).attr("class","fa fa-spin fa-spinner"),f.is(":visible")&&f.hide(),$(".progress-bar",d).width("0").attr("aria-valuenow","0"),$(".progress-bar span",d).html(""),d.show(),u.is(":hidden")&&u.show(),e(a.originalEvent.dataTransfer.files)}function e(a){if(a&&a.length&&!g.length){v=0,w=0,h.empty();for(var o=0;o<a.length;o++)g.push(a[o]),v+=a[o].size;i()}}function r(o){w+=o,a(w/v),i()}function t(o){var n=w+o.loaded;a(n/v)}function s(a,o){var n=new XMLHttpRequest;n.open("POST",window.location.href),n.onload=function(){h.append(this.responseText),r(a.size)},n.onerror=function(){h.html(this.responseText),r(a.size)},n.upload.onprogress=function(a){t(a)},n.upload.onloadstart=function(a){};var e=new FormData;e.append("file",a),n.send(e)}function i(){if(g.length){var a=g.shift();a.size>=c?($("strong",f).html(a.name),f.show(),r(a.size)):s(a,status)}else $(".fa",l).attr("class","fa fa-cloud-upload"),d.hide()}var p=$("#uploader .upload-area"),l=$("#uploader .upload-icon"),u=$("#uploader .upload-info"),d=$("#uploader .progress"),f=$("#uploader .upload-error"),h=$("#uploader .upload-result"),c=10485760,g=[],v=0,w=0;p.on({drop:n,dragover:o})});